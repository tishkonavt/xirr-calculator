# XIRR Calculator

Веб-приложение для расчета годовой (XIRR) и кумулятивной доходности портфеля.

## Требования

- Java 17 или выше
- Gradle 8.5+
- Доступ к gRPC сервису BofficerApi

## Установка и запуск

### 1. Клонируйте репозиторий
```bash
git clone <URL-вашего-репозитория>
cd xirr-calculator
```

### 2. Соберите проект
```bash
./gradlew clean build
```

### 3. Запустите веб-сервер
```bash
./gradlew run
```

Сервер запустится на `http://localhost:8080`

## Использование

1. Откройте браузер и перейдите на http://localhost:8080
2. Заполните форму:
   - **gRPC Host**: адрес gRPC сервера (например: 10.77.8.30)
   - **gRPC Port**: порт gRPC сервера (например: 30903)
   - **Authorization Token**: токен авторизации (если требуется)
   - **Account ID**: ID счета
   - **Trade System Name**: название торговой системы (например: TR1)
   - **From Date**: начальная дата периода
   - **To Date**: конечная дата периода
   - **Currency**: валюта (RUB, USD, EUR)
3. Нажмите "Построить графики"
4. Просмотрите графики годовой и кумулятивной доходности

## Структура проекта
```
xirr-calculator/
├── app/
│   ├── src/
│   │   ├── main/
│   │   │   ├── kotlin/
│   │   │   │   └── com/xirr/
│   │   │   │       ├── calculator/     # Логика расчета XIRR
│   │   │   │       ├── chart/          # Генерация графиков
│   │   │   │       ├── data/           # Провайдеры данных (gRPC, CSV)
│   │   │   │       ├── models/         # Модели данных
│   │   │   │       ├── Main.kt         # Консольное приложение
│   │   │   │       └── WebServer.kt    # Веб-сервер
│   │   │   ├── proto/                  # Proto файлы для gRPC
│   │   │   └── resources/              # Ресурсы (CSV файлы)
│   │   └── test/
│   └── build.gradle.kts
├── gradle/
├── gradlew
├── settings.gradle.kts
└── README.md
```

## Технологии

- **Kotlin** - язык программирования
- **Gradle** - система сборки
- **Ktor** - веб-фреймворк
- **gRPC** - для интеграции с внешним API
- **XChart** - библиотека для построения графиков
- **Protocol Buffers** - сериализация данных

## Алгоритм расчета

### XIRR (Extended Internal Rate of Return)
Годовая доходность рассчитывается методом Ньютона для решения уравнения NPV = 0.

### Кумулятивная доходность
Рассчитывается по формуле: `(1 + XIRR)^years - 1`

## Troubleshooting

### Ошибка подключения к gRPC
Убедитесь, что:
- gRPC сервер доступен по указанному адресу и порту
- Токен авторизации корректный
- Нет блокировок файрволла

### OutOfMemoryError
Увеличьте heap size при запуске:
```bash
JAVA_OPTS="-Xmx1g" ./gradlew run
```

